!bake
mkdir -p .built
valac --fast-vapi=.built/test2.vapi test2.vala
touch .built/test2.vapi-stamp
valac --fast-vapi=.built/test3.vapi test3.vala
touch .built/test3.vapi-stamp
valac --ccode test1.vala --use-fast-vapi=.built/test2.vapi --use-fast-vapi=.built/test3.vapi
touch .built/test1.c-stamp
gcc -Wno-unused -fPIC -c .built/test1.c -o .built/test1.o
valac --fast-vapi=.built/test1.vapi test1.vala
touch .built/test1.vapi-stamp
valac --ccode test2.vala --use-fast-vapi=.built/test1.vapi --use-fast-vapi=.built/test3.vapi
touch .built/test2.c-stamp
gcc -Wno-unused -fPIC -c .built/test2.c -o .built/test2.o
valac --ccode test3.vala --use-fast-vapi=.built/test1.vapi --use-fast-vapi=.built/test2.vapi
touch .built/test3.c-stamp
gcc -Wno-unused -fPIC -c .built/test3.c -o .built/test3.o
gcc -o libtest.so.0 -shared .built/test1.o .built/test2.o .built/test3.o
valac --ccode --header=test.h --vapi=test-0.vapi --library=test --use-fast-vapi=.built/test1.vapi --use-fast-vapi=.built/test2.vapi --use-fast-vapi=.built/test3.vapi
xgettext --extract-all --language=C --keyword=_ --escape --output=.built/test1.vala.po test1.vala
touch .built/test1.vala.po
xgettext --extract-all --language=C --keyword=_ --escape --output=.built/test2.vala.po test2.vala
touch .built/test2.vala.po
xgettext --extract-all --language=C --keyword=_ --escape --output=.built/test3.vala.po test3.vala
touch .built/test3.vala.po
msgcat --force-po --output-file=test.pot .built/test1.vala.po .built/test2.vala.po .built/test3.vala.po
(exit 0)
!bake install
mkdir -p /usr/local/lib
install libtest.so /usr/local/lib/libtest.so
install libtest.so.0 /usr/local/lib/libtest.so.0
mkdir -p /usr/local/lib/pkgconfig
install test-0.pc /usr/local/lib/pkgconfig/test-0.pc
mkdir -p /usr/local/include/test-0
install test.h /usr/local/include/test-0/test.h
mkdir -p /usr/local/share/vala/vapi
install test-0.vapi /usr/local/share/vala/vapi/test-0.vapi
(exit 0)
!bake clean
rm -f libtest.so.0
rm -f test.h
rm -f test-0.vapi
rm -rf .built/
rm -f libtest.so
rm -f test-0.pc
rm -f test.pot
(exit 0)
